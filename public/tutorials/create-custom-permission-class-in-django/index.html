<!DOCTYPE html>
<html
  lang="en"
  data-theme="light"
>
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  


<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/roboto-slab-latin-400.woff2"
  crossorigin="anonymous"
/>

<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/roboto-slab-latin-700.woff2"
  crossorigin="anonymous"
/>


<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/fira-code-latin-300.woff2"
  crossorigin="anonymous"
/>
<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/fira-code-latin-400.woff2"
  crossorigin="anonymous"
/>

<link
  rel="preload"
  as="font"
  type="font/woff2"
  href="/fonts/fira-code-latin-700.woff2"
  crossorigin="anonymous"
/>

  
  
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />
  




<title>How to Create Custom Permission Class in Django</title>

<meta
  name="description"
  content="Permissions can be a hustle to deal with when developing an api. Suppose we have a number of api views and endpoints where the access permissions are very similar to one another with only slight variations..
We could create different permission classes with the slight changes that fit the specific endpoint&amp;rsquo;s needs. That works, but that involves a lot of repetition and duplicated code that can be hard to update later down the line."
/>

<link rel="canonical" href="https://blog.okello.io/tutorials/create-custom-permission-class-in-django/" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to Create Custom Permission Class in Django"/>
<meta name="twitter:description" content="Permissions can be a hustle to deal with when developing an api. Suppose we have a number of api views and endpoints where the access permissions are very similar to one another with only slight variations..
We could create different permission classes with the slight changes that fit the specific endpoint&rsquo;s needs. That works, but that involves a lot of repetition and duplicated code that can be hard to update later down the line."/>

<meta property="og:title" content="How to Create Custom Permission Class in Django" />
<meta property="og:description" content="Permissions can be a hustle to deal with when developing an api. Suppose we have a number of api views and endpoints where the access permissions are very similar to one another with only slight variations..
We could create different permission classes with the slight changes that fit the specific endpoint&rsquo;s needs. That works, but that involves a lot of repetition and duplicated code that can be hard to update later down the line." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.okello.io/tutorials/create-custom-permission-class-in-django/" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2023-07-25T15:36:25+03:00" />
<meta property="article:modified_time" content="2023-07-25T15:36:25+03:00" />

<meta itemprop="name" content="How to Create Custom Permission Class in Django">
<meta itemprop="description" content="Permissions can be a hustle to deal with when developing an api. Suppose we have a number of api views and endpoints where the access permissions are very similar to one another with only slight variations..
We could create different permission classes with the slight changes that fit the specific endpoint&rsquo;s needs. That works, but that involves a lot of repetition and duplicated code that can be hard to update later down the line."><meta itemprop="datePublished" content="2023-07-25T15:36:25+03:00" />
<meta itemprop="dateModified" content="2023-07-25T15:36:25+03:00" />
<meta itemprop="wordCount" content="1925">
<meta itemprop="keywords" content="tutorial,python,django,permissions,security," />








  
  


  








  
  
  
  


<style>
   
  @font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:100;src:local("Roboto Slab Thin "),local("Roboto Slab-Thin"),url(/fonts/roboto-slab-latin-100.woff2) format("woff2"),url(/fonts/roboto-slab-latin-100.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:200;src:local("Roboto Slab Extra Light "),local("Roboto Slab-Extra Light"),url(/fonts/roboto-slab-latin-200.woff2) format("woff2"),url(/fonts/roboto-slab-latin-200.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:300;src:local("Roboto Slab Light "),local("Roboto Slab-Light"),url(/fonts/roboto-slab-latin-300.woff2) format("woff2"),url(/fonts/roboto-slab-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:400;src:local("Roboto Slab Regular "),local("Roboto Slab-Regular"),url(/fonts/roboto-slab-latin-400.woff2) format("woff2"),url(/fonts/roboto-slab-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:500;src:local("Roboto Slab Medium "),local("Roboto Slab-Medium"),url(/fonts/roboto-slab-latin-500.woff2) format("woff2"),url(/fonts/roboto-slab-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:600;src:local("Roboto Slab SemiBold "),local("Roboto Slab-SemiBold"),url(/fonts/roboto-slab-latin-600.woff2) format("woff2"),url(/fonts/roboto-slab-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:700;src:local("Roboto Slab Bold "),local("Roboto Slab-Bold"),url(/fonts/roboto-slab-latin-700.woff2) format("woff2"),url(/fonts/roboto-slab-latin-700.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:800;src:local("Roboto Slab ExtraBold "),local("Roboto Slab-ExtraBold"),url(/fonts/roboto-slab-latin-800.woff2) format("woff2"),url(/fonts/roboto-slab-latin-800.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:900;src:local("Roboto Slab Black "),local("Roboto Slab-Black"),url(/fonts/roboto-slab-latin-900.woff2) format("woff2"),url(/fonts/roboto-slab-latin-900.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:300;src:local("Fira Code Light "),local("Fira Code-Light"),url(/fonts/fira-code-latin-300.woff2) format("woff2"),url(/fonts/fira-code-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:400;src:local("Fira Code Regular "),local("Fira Code-Regular"),url(/fonts/fira-code-latin-400.woff2) format("woff2"),url(/fonts/fira-code-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:500;src:local("Fira Code Medium "),local("Fira Code-Medium"),url(/fonts/fira-code-latin-500.woff2) format("woff2"),url(/fonts/fira-code-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:600;src:local("Fira Code SemiBold "),local("Fira Code-SemiBold"),url(/fonts/fira-code-latin-600.woff2) format("woff2"),url(/fonts/fira-code-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:700;src:local("Fira Code Bold "),local("Fira Code-Bold"),url(/fonts/fira-code-latin-700.woff2) format("woff2"),url(/fonts/fira-code-latin-700.woff) format("woff")}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}

/*! CC BY-SA 3.0 License | https://stackoverflow.com/a/36118384/1154965 */@keyframes blink{50%{opacity:0}to{opacity:1}}

/*! MIT License | github.com/schnerring/hugo-theme-gruvbox */:root[data-theme=light]{--bg:var(--bg0);--bg0:#fbf1c7;--bg0_h:#f9f5d7;--bg0_s:#f2e5bc;--bg1:#ebdbb2;--bg2:#d5c4a1;--bg3:#bdae93;--bg4:#a89984;--fg:var(--fg1);--fg0:#282828;--fg1:#3c3836;--fg2:#504945;--fg3:#665c54;--fg4:#7c6f64;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#9d0006;--green1:#98971a;--green2:#797403;--yellow1:#d79921;--yellow2:#b57614;--blue1:#458588;--blue2:#076678;--purple1:#b16286;--purple2:#8f3f71;--aqua1:#689d6a;--aqua2:#427b58;--orange1:#d65d0e;--orange2:#af3a03}[data-theme=light]:root .light--hidden{display:none}:root[data-theme=dark]{--bg:var(--bg0);--bg0:#282828;--bg0_h:#1d2021;--bg0_s:#32302f;--bg1:#3c3836;--bg2:#504945;--bg3:#665c54;--bg4:#7c6f64;--fg:var(--fg1);--fg0:#fbf1c7;--fg1:#ebdbb2;--fg2:#d5c4a1;--fg3:#bdae93;--fg4:#a89984;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#fb4934;--green1:#98971a;--green2:#b8bb26;--yellow1:#d79921;--yellow2:#fabd2f;--blue1:#458588;--blue2:#83a598;--purple1:#b16286;--purple2:#d3869b;--aqua1:#689d6a;--aqua2:#8ec07c;--orange1:#d65d0e;--orange2:#fe8019}[data-theme=dark]:root .dark--hidden{display:none}:root{--primary:var(--blue1);--primary-alt:var(--blue2);--font-monospace:"Fira Code","Lucida Console",Monaco,monospace;--font-sans-serif:Verdana,Helvetica,sans-serif;--font-serif:"Roboto Slab",Georgia,serif}html{font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:1rem;scroll-behavior:smooth}body{word-wrap:break-word;background:var(--bg);color:var(--fg);line-height:1.675}strong{letter-spacing:.35px}a{color:inherit;-webkit-text-decoration:none;text-decoration:none}a.link--external:after{content:"\2009↗"}img{border:2px solid var(--bg1);height:auto;max-width:100%}figure{display:inline-block}figcaption{color:var(--fg3);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:.9rem}::-moz-selection{background:var(--bg4);color:var(--fg0)}::selection{background:var(--bg4);color:var(--fg0)}h1,h2,h3,h4{color:var(--fg0);font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-weight:300;line-height:1.4}h1 code,h2 code,h3 code,h4 code{font-size:1em}h2,h3,h4{border-bottom:1px solid var(--bg1)}h1,h2{font-weight:400}h1{font-size:1.875rem}h2{font-size:1.75rem}h3{font-size:1.625rem}@media (min-width:768px){h1{font-size:2.375rem}h2{font-size:2rem}h3{font-size:1.75rem}}h4{font-size:1.5rem}hr{background:var(--bg1);border:none;height:1px;margin:3rem auto;width:80%}code,pre{border-radius:.2rem;padding:0 .2em}pre code{padding:0}code,pre{background:var(--bg1)}code,pre{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}code code{background:var(--bg2)}pre{padding:1rem}pre{background:var(--bg1)!important;overflow:auto}pre code{background:none}pre::-webkit-scrollbar{height:.5rem;scrollbar-width:auto}pre::-webkit-scrollbar-track{background:var(--bg2);border-radius:.2rem}pre::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:.2rem}.layout{display:grid;grid-template-areas:"header" "main" "footer";grid-template-rows:auto 1fr auto;height:100vh}main{align-items:start;display:grid;grid-area:main;grid-template-areas:"empty content sidebar";grid-template-columns:1fr minmax(0,650px) 4fr}header{background:var(--bg1);grid-area:header}footer{grid-area:footer}footer,main{margin:.5em 1.1em}.content{grid-area:content}.sidebar{display:none;flex-direction:column;grid-area:sidebar;margin-top:3rem;position:sticky;top:2rem}@media (min-width:992px){.sidebar{display:flex}}header{display:grid;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-size:1.125rem;grid-template-areas:"heading search nav theme-toggle";grid-template-columns:auto auto 1fr auto;padding:.75rem}.logo{color:var(--fg0);display:flex;font-weight:700;grid-area:heading}.logo:hover .logo__cursor{animation:blink 1s infinite;opacity:1}.logo__chevron,.logo__cursor{margin-left:.5rem}.logo__cursor{opacity:0}.logo__text{display:none}@media (min-width:768px){.logo__text{display:block}}.search{display:flex;grid-area:search;margin:0 1rem}#search__text{background:var(--bg2);border:1px solid var(--bg2);border-radius:.2rem;caret-color:var(--fg);color:var(--fg);outline:none;padding:0 .5rem;width:100%}#search__text:hover{border-color:var(--bg3)}#search__text:focus{border-color:var(--bg4)}#search__text::-moz-placeholder{color:var(--fg3)}#search__text::placeholder{color:var(--fg3)}#search__text[type=search]::-webkit-search-cancel-button{-webkit-appearance:none;appearance:none}#search__suggestions{background:var(--bg);border-radius:.2rem;box-shadow:0 .5rem 1rem var(--bg1);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);left:0;margin-top:2rem;position:absolute;width:95vw;z-index:1000}@media (min-width:768px){.search{position:relative}#search__suggestions{width:60vw}}.search__suggestions--hidden{display:none}.search__suggestion-item{border-bottom:1px dashed var(--bg2);display:grid;grid-template-columns:1fr 2fr}.search__suggestion-item:focus,.search__suggestion-item:focus-visible,.search__suggestion-item:hover{background:var(--bg1);cursor:pointer;outline:none}.search__suggestion-item:last-child{border:none}.search__suggestion-description,.search__suggestion-title{margin:1rem 0;padding:0 1rem}.search__suggestion-title{font-weight:700}.search__suggestion-description{border-left:1px solid var(--bg2)}.search__no-results{padding:.75rem}.theme__toggle{align-items:center;background:none;border:none;color:var(--yellow1);cursor:pointer;display:flex;grid-area:theme-toggle;margin:0 1rem}.theme__toggle:hover{color:var(--yellow2)}.theme__toggle svg{height:28px;width:28px}nav#menu{align-items:center;display:flex;grid-area:nav;justify-content:flex-end}nav#menu .menu__item{color:var(--fg)}nav#menu .menu__item:hover{color:var(--fg3);cursor:pointer}nav#menu ul{list-style:none;margin:0;padding:0}nav#menu ul.menu--horizontal{align-items:center;display:none}nav#menu ul.menu--horizontal li{display:inline-block;margin:0 .75rem}@media (min-width:768px){nav#menu ul.menu--horizontal{display:flex}}nav#menu ul.menu--vertical{background:var(--fg0);bottom:0;margin:0;padding:3rem;position:fixed;right:0;top:0;transform:translate(100%);transition:transform .5s cubic-bezier(.9,0,.1,1);width:50%;z-index:10}nav#menu ul.menu--vertical .menu__item{color:var(--bg1)}nav#menu ul.menu--vertical .menu__item:hover{color:var(--bg4)}nav#menu .menu__burger{display:flex;height:24px;width:24px}nav#menu .menu__burger>*{position:absolute}nav#menu .menu__burger svg{height:inherit;width:inherit;z-index:20}nav#menu .menu__burger input{height:inherit;opacity:0;width:inherit;z-index:30}nav#menu .menu__burger input:checked~ul.menu--vertical{transform:none}nav#menu .menu__burger input:checked~svg{stroke:var(--bg1)}@media (min-width:768px){nav#menu .menu__burger{display:none}}.post-preview{margin-left:5%;max-width:90%}.post-preview-header{color:var(--blue1);font-size:1.4rem}.post-preview-content{font-size:.9rem;font-weight:300}.sidebar{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);margin-left:auto;margin-right:auto;max-width:350px;padding-left:2.5rem}.sidebar svg{fill:var(--fg)}.sidebar__heading{font-size:1.3rem}aside.toc a{color:var(--blue2);color:var(--primary-alt)}aside.toc a:hover{color:var(--blue1);color:var(--primary)}aside.toc ul{list-style:none;margin:0;padding:0}aside.toc ul ul{font-size:.9rem;margin-left:.5rem}aside.toc ul li{line-height:1.1}aside.toc ul li a{display:block;padding:.2rem 0}.tag__active{background-color:var(--bg2);color:var(--fg);padding-left:.2rem;padding-right:.2rem}.content-section,.post{border-bottom:2px dotted var(--bg1);padding:2rem 0}.post figure,.post img:not(figure img){box-sizing:border-box;margin:.5rem 0}.post-content__read-more,.post-header{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}.post-content{margin:1.3rem 0}.post-content__read-more{margin-top:1.3rem}.post-content a,.post-content__read-more,.post-header a{color:var(--blue2);color:var(--primary-alt)}.post-content a:hover,.post-header a:hover{color:var(--blue1);color:var(--primary)}.post-tags{align-items:center;display:flex;flex-wrap:wrap;gap:.9rem;margin:1rem 0}.post-tag{font-size:.9rem;line-height:1}.post-tag:before{content:"#"}.post-heading__anchor{display:none}h1:hover .post-heading__anchor,h2:hover .post-heading__anchor,h3:hover .post-heading__anchor,h4:hover .post-heading__anchor{display:inline-block}
   
</style>

<link
  rel="preload"
  href="/css/non-critical.a695b88a0957271618f786794127c4dc409c85101336d84e8b2c6e10556b20c68008fa60877756c974b9b57949bdc786fe767cfdaaa4af046414a977b5d5c2a3.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
  
    integrity="sha512-ppW4iglXJxYY94Z5QSfE3ECchRATNthOiyxuEFVrIMaACPpgh3dWyXS5tXlJvceG/nZ8/aqkrwRkFKl3tdXCow=="
  
/>


<link
  id="prism-dark"
  rel="preload"
  href="/prism-themes/prism-gruvbox-dark.min.54aecc64074623a4f9898544dcbdab9e804f1560ef0b38f4cf8e10fcaaf72264e798cb407c601aca6ecd833ec4eb93d66535581f18d45ba202cf848b70dbc332.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
  integrity="sha512-VK7MZAdGI6T5iYVE3L2rnoBPFWDvCzj0z44Q/Kr3ImTnmMtAfGAaym7Ngz7E65PWZTVYHxjUW6ICz4SLcNvDMg=="
  disabled
/>


<link
  id="prism-light"
  rel="preload"
  href="/prism-themes/prism-gruvbox-light.min.42a221741efe997fcc94187c39d63c555560678789ac9ca856c74a5f0ddb2aa6c50d38b2ffbecc7a99038cbbd2efa99746e862267f781c559e0cfec10b88a5fc.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
  
    integrity="sha512-QqIhdB7&#43;mX/MlBh8OdY8VVVgZ4eJrJyoVsdKXw3bKqbFDTiy/77MepkDjLvS76mXRuhiJn94HFWeDP7BC4il/A=="
  
  
/>

<noscript>
  
    <link
      rel="stylesheet"
      href="/prism-themes/prism-gruvbox-light.min.42a221741efe997fcc94187c39d63c555560678789ac9ca856c74a5f0ddb2aa6c50d38b2ffbecc7a99038cbbd2efa99746e862267f781c559e0cfec10b88a5fc.css"
      
        integrity="sha512-QqIhdB7&#43;mX/MlBh8OdY8VVVgZ4eJrJyoVsdKXw3bKqbFDTiy/77MepkDjLvS76mXRuhiJn94HFWeDP7BC4il/A=="
      
    />
  


  <link
    rel="stylesheet"
    href="/css/non-critical.a695b88a0957271618f786794127c4dc409c85101336d84e8b2c6e10556b20c68008fa60877756c974b9b57949bdc786fe767cfdaaa4af046414a977b5d5c2a3.css"
    
      integrity="sha512-ppW4iglXJxYY94Z5QSfE3ECchRATNthOiyxuEFVrIMaACPpgh3dWyXS5tXlJvceG/nZ8/aqkrwRkFKl3tdXCow=="
    
  />
</noscript>


  

  




<script>
  (()=>{function c(){if(localStorage&&localStorage.getItem("theme"))return localStorage.getItem("theme");if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function n(t){document.documentElement.setAttribute("data-theme",t);let e=document.getElementById("prism-dark"),i=document.getElementById("prism-light");e.toggleAttribute("disabled",t==="light"),i.toggleAttribute("disabled",t==="dark"),localStorage.setItem("theme",t)}var o=c();o&&n(o);function l(t){let e=t.currentTarget.classList.contains("light--hidden")?"light":"dark";n(e)}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".theme__toggle").forEach(e=>{e.addEventListener("click",l)})});})();

</script>


  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#282828" />
<meta name="msapplication-TileColor" content="#282828" />
<meta name="theme-color" content="#282828" />



  
  

</head>

  <body>
    <div class="layout">
      <header>
  <a
    class="logo"
    href="/"
  >
    
      <div class="logo__text">RH</div>
    
    <div class="logo__chevron">></div>
    <div class="logo__cursor">█</div>
  </a>

  <div class="search">
    <input
      id="search__text"
      type="search"
      placeholder="Search..."
      aria-label="Search"
      autocomplete="off"
    />
    <div id="search__suggestions" class="search__suggestions--hidden"></div>
  </div>

  <nav id="menu">
    <ul class="menu--horizontal">
      
        <li class="menu__item">
          <a href="/tutorials/">How-To</a>
        </li>
      
        <li class="menu__item">
          <a href="https://okello.io">About</a>
        </li>
      
    </ul>

    <div class="menu__burger">
      
      <input class="menu__item" type="checkbox" aria-label="Open main menu" />

      
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 6l16 0" />
  <path d="M4 12l16 0" />
  <path d="M4 18l16 0" />
</svg>







      <ul class="menu--vertical">
        
          <li>
            <a class="menu__item" href="/tutorials/">How-To</a>
          </li>
        
          <li>
            <a class="menu__item" href="https://okello.io">About</a>
          </li>
        
      </ul>
    </div>
  </nav>

  <button class="theme__toggle light--hidden" aria-label="Toggle light mode">
    
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
  <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
</svg>





  </button>

  <button class="theme__toggle dark--hidden" aria-label="Toggle dark mode">
    
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
</svg>





  </button>
  
</header>

      <main>
        <div class="content">
          
  <article class="post">
    <div class="post-header">
      <h1>How to Create Custom Permission Class in Django</h1>
      <div class="post-meta"><span>2023-07-25</span>
    <div class="post-tags">
      <a class="post-tag" href="https://blog.okello.io/tags/tutorial">tutorial</a><a class="post-tag" href="https://blog.okello.io/tags/python">python</a><a class="post-tag" href="https://blog.okello.io/tags/django">django</a><a class="post-tag" href="https://blog.okello.io/tags/permissions">permissions</a><a class="post-tag" href="https://blog.okello.io/tags/security">security</a>
    </div>
  

  
</div>

    </div>

    <div class="post-content">
      <p>Permissions can be a hustle to deal with when developing an api. Suppose we have a number of api views and endpoints where the access permissions are very similar to one another with only slight variations..<br>
We could create different permission classes with the slight changes that fit the specific endpoint&rsquo;s needs. That works, but that involves a lot of repetition and duplicated code that can be hard to update later down the line.</p>
<p>This is where an abstract or generic permission class comes in handy. We can define template permissions and logic that can be inherited and extended by child permission classes or the modified in the ViewSet class like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># views.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> somewhere <span style="color:#f92672">import</span> AbstractPermission
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyViewSet</span>(viewsets<span style="color:#f92672">.</span>ModelViewSet):
</span></span><span style="display:flex;"><span>    serializer_class <span style="color:#f92672">=</span> MySerializer
</span></span><span style="display:flex;"><span>    permission_classes <span style="color:#f92672">=</span> (AbstractPermission,)
</span></span><span style="display:flex;"><span>    deny_action <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;CLIENT&#34;</span>: (<span style="color:#e6db74">&#34;create&#34;</span>,)
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="defining-our-structure">Defining our structure<a href="#defining-our-structure" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>To get started, we can have an example project for CozyCoin Bank with branches in different countries. Each branch has one manager, several clerks, and marketers. CozyCoin customers are rich and can also have multiple bank accounts. Below are our simple models. I have only included fields necessary for explanations.
All the user models inherit from a default user model class were the common fields for all users are defined. For our specific case, we are using the <code>roles</code> field to specify which group the user falls under, but you can use django groups if you wish. I find assigning roles much easier to manage.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># models.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(AbstractBaseUser):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Roles</span>(models<span style="color:#f92672">.</span>TextChoices):
</span></span><span style="display:flex;"><span>        MANAGER <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MANAGER&#34;</span>, <span style="color:#e6db74">&#34;Manager&#34;</span>
</span></span><span style="display:flex;"><span>        SUPPORT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SUPPORT&#34;</span>, <span style="color:#e6db74">&#34;Support&#34;</span>
</span></span><span style="display:flex;"><span>        CLERK <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CLERK&#34;</span>, <span style="color:#e6db74">&#34;Clerk&#34;</span>
</span></span><span style="display:flex;"><span>        CUSTOMER <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CUSTOMER&#34;</span>, <span style="color:#e6db74">&#34;Customer&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BankBranch</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    manager <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Manager, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Customer</span>(User):
</span></span><span style="display:flex;"><span>    role <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, default<span style="color:#f92672">=</span>User<span style="color:#f92672">.</span>Roles<span style="color:#f92672">.</span>CUSTOMER<span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Manager</span>(User):
</span></span><span style="display:flex;"><span>    role <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, default<span style="color:#f92672">=</span>User<span style="color:#f92672">.</span>Roles<span style="color:#f92672">.</span>MANAGER<span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Clerk</span>(User):
</span></span><span style="display:flex;"><span>    role <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, default<span style="color:#f92672">=</span>User<span style="color:#f92672">.</span>Roles<span style="color:#f92672">.</span>CLERK<span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Support</span>(User):
</span></span><span style="display:flex;"><span>    role <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, default<span style="color:#f92672">=</span>User<span style="color:#f92672">.</span>Roles<span style="color:#f92672">.</span>SUPPORT<span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Account</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    customer <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Customer, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>    bank_branch <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Bank, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Transactions</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    account <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Account, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p>Let&rsquo;s assume that the serializers and views have also been setup with a sample viewset looking like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># views.py</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomeModelViewSet</span>(viewsets<span style="color:#f92672">.</span>ModelViewSet):
</span></span><span style="display:flex;"><span>    serializer_class <span style="color:#f92672">=</span> SomeModelSerializer
</span></span><span style="display:flex;"><span>    permission_classes <span style="color:#f92672">=</span> (SomePermissionClass,) <span style="color:#75715e"># this is the important part</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_queryset</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># your queryset logic here</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><h2 id="creating-the-abstract-permission-class">Creating the abstract permission class<a href="#creating-the-abstract-permission-class" class="post-heading__anchor" aria-hidden="true">#</a>
</h2>
<h3 id="a-basic-permission-class">A basic permission class<a href="#a-basic-permission-class" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>In order to determine if a user has permissions depending on their role, we first have to create an abstract permission class that inherits from rest framework&rsquo;s <code>BasePermission</code>.
We will deny any anonymous request since we require the user to be logged in to view their role. If you don&rsquo;t have an account of any sort with CozyCoin, then you shouldn&rsquo;t have access to anything protected by these permissions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> rest_framework <span style="color:#f92672">import</span> permissions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsRole</span>(permissions<span style="color:#f92672">.</span>BasePermission):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_permission</span>(self, request, view):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>is_anonymous:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> Fals<span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_object_permission</span>(self, request, view, obj):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>For our permissions to be effective, we first have to determine if the user making the request is in the desired group.
The <code>role</code> property is initialized to <code>None</code> and is supposed to be modified in the child classes. If it is not, then <code>SomeError</code>is raised.
<code>SomeError</code> being an error of your choosing. This will ensure that the permissions don&rsquo;t silently fail and deny all requests since the <code>role</code> will always be <code>None</code> and therefor not match any roles.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsRole</span>(permissions<span style="color:#f92672">.</span>BasePermission):
</span></span><span style="display:flex;"><span>    role <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_permission</span>(self, request, view):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>is_anonymous:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> Fals<span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>has_role(request):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_object_permission</span>(self, request, view, obj):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>has_role(request)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_role</span>(self, request)<span style="color:#f92672">-&gt;</span> bool:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>role <span style="color:#f92672">==</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> SomeError
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>role <span style="color:#f92672">==</span> self<span style="color:#f92672">.</span>role
</span></span></code></pre></div><p>And that&rsquo;s it! We can create child classes that specify the roles we want to grant access to. For example:</p>
<pre tabindex="0"><code class="language-pytho." data-lang="pytho."># views.py
from some_location.permissions import IsRole

class IsCustomer(IsRole):
    role = &#34;CUSTOMER&#34;

class CustomerOnlyView(viewsets.ViewSet):
    permission_classes = (IsCustomer,)
    ...
</code></pre><h3 id="granting-only-the-owner-of-an-object-permissions">Granting only the owner of an object permissions<a href="#granting-only-the-owner-of-an-object-permissions" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>The permissions we have defined above are perfectly usable, but if you are keen you might have noticed a problem. Taking the <code>IsCustomer</code> permissions for example, if the request user is not a customer they will be blocked just fine. The problem is the customer can  request for any customer data that is not theirs and it will be granted to them. This means that any customer can view any other customer&rsquo;s data in a view protected by these permissions. To help with this issue, we need to tweak our <code>has_object_permission</code> method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_object_permission</span>(self, request, view, obj):
</span></span><span style="display:flex;"><span>        owner <span style="color:#f92672">=</span> getattr(obj, self<span style="color:#f92672">.</span>role<span style="color:#f92672">.</span>lower())
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> owner<span style="color:#f92672">.</span>id <span style="color:#f92672">==</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>id
</span></span></code></pre></div><p>With this small tweak, instead of just giving any data to anyone so long as they have a certain role, we will be able to only limit th.<br>
data to what they own or is linked to them. This assumes that the foreign key field pointing to the user table is named the same as the role but in all lowercase. This means that if the role is <code>CLIENT</code>, then the foreign key field in the model is called <code>client</code>. An alternative it to get the name of the fields to check at runtime instead of relying on the role name which could be different.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsRole</span>(permissions<span style="color:#f92672">.</span>BasePermission):
</span></span><span style="display:flex;"><span>    owner_field <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_object_permission</span>(self, request, view, obj):
</span></span><span style="display:flex;"><span>        user <span style="color:#f92672">=</span> getattr(obj, self<span style="color:#f92672">.</span>owner_field <span style="color:#f92672">or</span> self<span style="color:#f92672">.</span>role<span style="color:#f92672">.</span>lower()))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> user<span style="color:#f92672">.</span>id <span style="color:#f92672">==</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsCustomer</span>(IsRole):
</span></span><span style="display:flex;"><span>    role <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CUSTOMER&#34;</span>
</span></span><span style="display:flex;"><span>    owner_field <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;client&#34;</span>
</span></span></code></pre></div><h3 id="granting-privileged-users-access">Granting privileged users access<a href="#granting-privileged-users-access" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>Wait, what if the person asking for the data has higher access rights like an admin or us? We don&rsquo;t want to make the managers feel less powerful. We have different ways we can deal with this problem. How you approach it will depend on what you named your abstract class and how abstract you want to go. The first approach is to use a variable that grants a set of user roles access. In this example, we can name the field <code>allow_staff</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsRole</span>(permissions<span style="color:#f92672">.</span>BasePermission):
</span></span><span style="display:flex;"><span>    allow_staff <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    staff_roles <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;ADMIN&#34;</span>, <span style="color:#e6db74">&#34;MANAGER&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_permission</span>(self, request, view, obj):
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>allow_staff <span style="color:#f92672">and</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>role <span style="color:#f92672">in</span> staff_roles:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_object_permission</span>(self, request, view, obj):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>allow_staff <span style="color:#f92672">and</span> request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>role <span style="color:#f92672">in</span> staff_roles:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>With this approach, we can define the <code>staff_roles</code> and set <code>allow_staff</code> to true to give the people with <code>staff_roles</code> access. If we want to go even more abstract then we can use the second approach were we can define <code>allow_roles</code> instead of <code>staff_roles</code>. With this we don&rsquo;t need to check if <code>allow_staff</code> is true or not, we just check if the current user role is one of the special ones.</p>
<h3 id="grant-access-by-view-action">Grant access by view action<a href="#grant-access-by-view-action" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>Now, that we can filter permissions by roles, we can also try filtering by the action being performed. For example we might not want a support staff member should not be able to view all the customers and their data in one place at once. (This is only useful with a non-incremental system object ID. There&rsquo;s nothing stopping Joe from going up the number of client IDs from one in an incremental system). We might want them to only have access to the specific client asking for support and only for a short period of
time or after they have been per-approved by a client issue ticket handling system. Also when Bob from marketing wants to send an email to all customers over 35, who look like they could use a loan, he will need not any permissions to modify customer data. So we will give him and his team read only access.</p>
<p>To achieve this, we can add it another attribute <code>deny_actions</code> to the abstract class. This attribute can be a list containing actions we want to deny on that endpoint. We can then check for the list in the <code>has_permission</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>deny_actions <span style="color:#f92672">and</span> view<span style="color:#f92672">.</span>action <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>deny_actions:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p>This solution is simple, but it will also deny any special privileged users from performing the actions. We can change it up slightly by making <code>deny_actions</code> accept a dictionary with the user roles as the keys and denied roles as the values. e.g:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>deny_actions <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;MARKETING&#34;</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can put the logic for that in a separate class method and only call it when we need to. We also raise an exception in case the values are not formatted correctly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_action_denied</span>(self, request, view):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(self<span style="color:#f92672">.</span>deny_actions, dict):
</span></span><span style="display:flex;"><span>            actions <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>deny_actions<span style="color:#f92672">.</span>get(request<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>role)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> isinstance(self<span style="color:#f92672">.</span>deny_actions, list <span style="color:#f92672">|</span> tuple):
</span></span><span style="display:flex;"><span>            actions <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>deny_actions
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid type </span><span style="color:#e6db74">{</span>type(self<span style="color:#f92672">.</span>deny_actions)<span style="color:#e6db74">}</span><span style="color:#e6db74"> for deny_actions. Expected iterable&#34;</span>
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> actions <span style="color:#f92672">and</span> view<span style="color:#f92672">.</span>action <span style="color:#f92672">in</span> actions:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><h3 id="getting-values-from-the-view">Getting values from the view<a href="#getting-values-from-the-view" class="post-heading__anchor" aria-hidden="true">#</a>
</h3>
<p>Sometimes you do not want to create an entire class just so you can change 1 value and use it on one view only. What would be point of doing all this work? We just need to have a bit more code and logic.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span>    deny_actions <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    allow_roles <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    allow_staff <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">has_permission</span>(self, request, view):
</span></span><span style="display:flex;"><span>        deny_actions <span style="color:#f92672">=</span> getattr(view, <span style="color:#e6db74">&#39;deny_actions&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        allow_roles <span style="color:#f92672">=</span> getattr(view, <span style="color:#e6db74">&#39;allow_roles&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        allow_staff <span style="color:#f92672">=</span> getattr(view, <span style="color:#e6db74">&#39;allow_staff&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span></code></pre></div><p>This will allow us to specify the extra values when creating the child permission classes or within the view like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># views.py</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomeModelViewSet</span>(viewsets<span style="color:#f92672">.</span>ModelViewSet):
</span></span><span style="display:flex;"><span>    serializer_class <span style="color:#f92672">=</span> SomeModelSerializer
</span></span><span style="display:flex;"><span>    permission_classes <span style="color:#f92672">=</span> (IsClient,)
</span></span><span style="display:flex;"><span>    allow_staff <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    deny_actions <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;MANAGER&#34;</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_queryset</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>The part where we fetch the filters can also bring up a problem if you have many of them, or if we increase the filters in the future.
So we define a method that is called by <code>has_permissions</code> method before doing anything.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># permissions.py</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_or_set_attributes</span>(self, request, view):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> attribute <span style="color:#f92672">in</span> dir(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> attribute<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;_&#34;</span>): <span style="color:#75715e"># ignore any magic methods and private variables</span>
</span></span><span style="display:flex;"><span>            value <span style="color:#f92672">=</span> getattr(self, attribute)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> value <span style="color:#f92672">==</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                setattr(self, attribute, getattr(view, attribute, <span style="color:#66d9ef">None</span>))
</span></span></code></pre></div><h2 id="limitations">Limitations<a href="#limitations" class="post-heading__anchor" aria-hidden="true">#</a>
</h2>
<p>So this method of creating things an abstract permissions class is very useful. It means we only have to make a few changes to existing and that&rsquo;s it.
If we need new very specific permissions, we don&rsquo;t have to duplicate some code from somewhere and only change a few things to fit the view. There are some issues with this approach.</p>
<ul>
<li>
<p>Too much code in one place.<br>
As we are trying to make the abstract class as versatile and flexible as possible, we have to cram so much logic and checks in it. This can very quickly
become a nightmare to maintain or to read back in 6 months.</p>
</li>
<li>
<p>Long setup time.<br>
It took me quite a while to come up with the class and logic. It works well for the most part, but it might be hard to adapt it to a different application.
Is it worth the time it took to make it?  ¯_(ツ)_/¯ Maybe it will be in the long run as I would just copy paste the class into other projects, and instantly
get customizable permissions without defining them once again.</p>
</li>
<li>
<p>Reliance on <code>role</code>.<br>
If you were to remove the role attribute, major parts of the class will have to be redone or rethought. With this structure, a user can only belong to one role.
This limitation could be overcome by allowing the primary search field to be set in child class or in the viewset.</p>
</li>
<li>
<p>Limited extensibility.<br>
There is only so much you can add before it becomes a too much. The best thing at that point would be to create a separate abstract permission class.</p>
</li>
<li>
<p>This only works class based views.
I have not created or tested a function based view version of this code, so it might not work for that use case</p>
</li>
</ul>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="post-heading__anchor" aria-hidden="true">#</a>
</h2>
<p>Thanks for getting to the end. Whether you got here by reading or scrolling or copy pasting. You can find the full permission class on <a
  href="https://gist.github.com/keystroke3/3166c27ed58abae849f9967d9044db75"
  
  
    class="link--external" target="_blank" rel="noreferrer"
  
>github gits</a></p>

    </div>

    

    
  </article>

        </div>
        <div class="sidebar">
  
    
      <aside class="toc">
        <nav>
          <p class="sidebar__heading">Table Of Contents</p>
          <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#defining-our-structure">Defining our structure</a></li>
      </ul>
    </li>
    <li><a href="#creating-the-abstract-permission-class">Creating the abstract permission class</a>
      <ul>
        <li><a href="#a-basic-permission-class">A basic permission class</a></li>
        <li><a href="#granting-only-the-owner-of-an-object-permissions">Granting only the owner of an object permissions</a></li>
        <li><a href="#granting-privileged-users-access">Granting privileged users access</a></li>
        <li><a href="#grant-access-by-view-action">Grant access by view action</a></li>
        <li><a href="#getting-values-from-the-view">Getting values from the view</a></li>
      </ul>
    </li>
    <li><a href="#limitations">Limitations</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </nav>
      </aside>
      <hr />
    
  

  
    <aside class="tag__cloud">
      










<div id="tag-cloud" style="padding: 5px 15px">
    
    
    
    
    
    
    <a href="/tags/algorithms"
        style="font-size:2.0239092917289776rem">algorithms</a>
    
    
    
    
    
    
    <a href="/tags/big-o"
        style="font-size:1.6460148371100896rem">big-o</a>
    
    
    
    
    
    
    <a href="/tags/config"
        style="font-size:1rem">config</a>
    
    
    
    
    
    
    <a href="/tags/debugging"
        style="font-size:1rem">debugging</a>
    
    
    
    
    
    
    <a href="/tags/django"
        style="font-size:1.6460148371100896rem">django</a>
    
    
    
    
    
    
    <a href="/tags/dsa"
        style="font-size:2.0239092917289776rem">dsa</a>
    
    
    
    
    
    
    <a href="/tags/explainer"
        style="font-size:2.0239092917289776rem">explainer</a>
    
    
    
    
    
    
    <a href="/tags/golang"
        style="font-size:2.292029674220179rem">golang</a>
    
    
    
    
    
    
    <a href="/tags/json"
        style="font-size:1rem">json</a>
    
    
    
    
    
    
    <a href="/tags/learning"
        style="font-size:1rem">learning</a>
    
    
    
    
    
    
    <a href="/tags/permissions"
        style="font-size:1rem">permissions</a>
    
    
    
    
    
    
    <a href="/tags/python"
        style="font-size:1.6460148371100896rem">python</a>
    
    
    
    
    
    
    <a href="/tags/security"
        style="font-size:1rem">security</a>
    
    
    
    
    
    
    <a href="/tags/tutorial"
        style="font-size:1.6460148371100896rem">tutorial</a>
    
</div>

    </aside>
  

</div>

      </main>
      <footer>
  <div class="copyright">
    
  </div>
</footer>



  







  
  



<script src="/js/main.93f2afc43f607a57e1b567f73a1509f24ce17810a62aea20bc84cd15fd5c1cb623be1fa949d7eb654a35c2bdf76089ba25637e99022969fdeac2746c0500a91a.js" integrity="sha512-k/KvxD9gelfhtWf3OhUJ8kzheBCmKuogvITNFf1cHLYjvh&#43;pSdfrZUo1wr33YIm6JWN&#43;mQIpaf3qwnRsBQCpGg=="></script>
<script src="/js/flexsearch.2b4be539dc87af2ffcb8ef5eec75bb6b80068cd744462e449627bdbbc3cd4f1f6d4e8f21ed6f34e94d0a216d4c59bf51be0886094f1ed267bd1eb33f1da61f6c.js" integrity="sha512-K0vlOdyHry/8uO9e7HW7a4AGjNdERi5Elie9u8PNTx9tTo8h7W806U0KIW1MWb9RvgiGCU8e0me9HrM/HaYfbA=="></script>






    </div>
  </body>
</html>
